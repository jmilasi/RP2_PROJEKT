<!DOCTYPE html>
<html lang="hr">
<head>
	<meta charset="utf-8" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Pregledavanje rasporeda</title>
	<link rel="stylesheet" type="text/css" href="css/style.css" />
	<link rel="stylesheet" type="text/css" href="css/stil.css" />
	<link rel="stylesheet" type="text/css" media="all" href="jsDatePick_ltr.min.css" />
	<script type="text/javascript" src="jsDatePick.min.1.3.js"></script>
	<script type="text/javascript" src="jquery-2.1.4.min.js"></script>
</head>

<body>
	<div id="calendar"></div>
	<div id="predavaonice" align="center"></div>
	<h2 id="tekst" align="center"></h2>
	<table id="raspored" align="center" style="visibility: hidden"></table>

	<script type="text/javascript">
		$(document).ready(function() {
			var date, room;
			var pred = "<table id='sobe'>" +
				"<tr><td>001</td><td>002</td><td>003</td></tr>" +
				"<tr><td>004</td><td>005</td><td>006</td></tr>" +
				"<tr><td>110</td><td>201</td><td>A101</td></tr>" +
				"</table>";

			globalObject = new JsDatePick({
				useMode: 1,
				isStripped: true,
				target: "calendar"
			});

			function ispis(data) {
				$("#tekst").text("Raspored predavaonice " + room + " za " + date);
				$("#raspored").text("");
				$("#raspored").append(
					"<tr><th>SAT</th>" +
					"<th>IME KOLEGIJA</th>" +
					"<th>PREDAVAČ</th></tr>"
					);
				
				var i = 8, j = 0;
				var ponovi = 0;
				
			while (i < 20) {
				// i je number, a data[j].sat je string
				if (j < data.length && data[j].SAT === i.toString()) { 
					var pamti = data[j].IME_KOLEGIJA;
					while (j+ponovi < data.length && pamti == data[j+ponovi].IME_KOLEGIJA) {
						ponovi++;
						i++;
					}

				$("#raspored").append(
					"<tr><td>" + data[j].SAT + " - " + i.toString() + 
					"</td><td>" + data[j].IME_KOLEGIJA +
					"</td><td>" + data[j].PREDAVAC +
					"</td></tr>");
					
					j += ponovi;
					ponovi = 0;
				}

				else {                                                                                
					$("#raspored").append(
						"<tr><td>" + i + " - " + (i+1) + 
						"</td><td>" + ""+
						"</td><td>" + ""+
						"</td></tr>"); 
					
					i++;
				}

			} // kraj while-petlje

			document.getElementById("raspored").style.visibility = "visible";
			} // kraj funkcije ispis()

			function klik() {
				$("#raspored").text(""); // obriši raspored prilikom klika na datum
				$("#tekst").text(""); // obriši što piše

				var obj = globalObject.getSelectedDay();
				date = obj.day + "." + obj.month + "." + obj.year + ".";

				var predavaonice = document.getElementById("predavaonice");
				predavaonice.innerHTML = pred; // tablica predavaonica      

				tds = document.getElementsByTagName("td");
				for (var i = 0; i < tds.length; ++i) {
					tds[i].onclick = function() {
						room = this.innerHTML;    
						var fil = {datum: date, predavaonica: room};
						document.getElementById("sobe").remove(); // obriši listu predavaonica prilikom klika na nju							
						$.ajax("samo_pregledaj.php", {
							type: "POST",
							contentType: "application/json",
							data: JSON.stringify(fil),
							success: function(data) {
								if (typeof(data) === "string") {
									alert(data);
									return;
								}
								else {
									ispis(data);
									return;
								}
							}
						}); // kraj ajaxa za raspored
					}; // kraj onclick-funkcije za td-ove 
				} // kraj for-petlje po td-ovima
			} // kraj funkcije klik()

			globalObject.setOnSelectedDelegate(function() {
				klik();
			}); // kraj globalObject-a
		}); // kraj documentReady-funkcije
	</script>
</body>
</html>